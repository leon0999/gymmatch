# GymMatch - Development Protocol

## 🎯 개발 원칙

### 핵심 규칙
1. **한 단계씩 구현**: 여러 기능을 동시에 만들지 않음
2. **단계마다 테스트**: 각 단계 완료 후 반드시 기능 플로우 테스트
3. **에러 제로**: 다음 단계로 넘어가기 전에 모든 에러 해결
4. **커밋 자주**: 각 단계 완료 시 GitHub 커밋
5. **문서화**: 완료된 기능은 README에 기록

---

## 📋 Phase 1: 매칭 후 핵심 기능 (이번 주)

### Step 1: 데이터베이스 스키마 구축
**작업**:
- `messages` 테이블 생성
- RLS 정책 설정
- 테스트 데이터 삽입

**테스트**:
- [ ] Supabase SQL Editor에서 테이블 확인
- [ ] RLS 정책 작동 확인 (SELECT/INSERT)
- [ ] 테스트 메시지 삽입/조회 성공

**완료 조건**: SQL 에러 없이 테이블 생성 완료

---

### Step 2: Matches 리스트 페이지
**작업**:
- `/matches` 페이지 생성
- 매칭된 사람들 리스트 표시
- 최근 메시지 미리보기
- 빈 상태 UI ("No matches yet")

**테스트**:
- [ ] 매칭 없을 때 빈 상태 표시
- [ ] 매칭 있을 때 리스트 표시
- [ ] 프로필 정보 정확히 표시 (이름, 나이, 위치)
- [ ] 클릭 시 채팅 페이지로 이동

**완료 조건**:
- 로그인한 사용자의 모든 매칭 표시
- 에러 없이 페이지 로드

---

### Step 3: Chat 1:1 채팅 (기본)
**작업**:
- `/chat/[matchId]` 페이지 생성
- 메시지 전송 기능
- 메시지 리스트 표시
- 상대방 정보 헤더

**테스트**:
- [ ] 메시지 전송 성공
- [ ] 메시지 리스트 표시
- [ ] 타임스탬프 정확히 표시
- [ ] 내 메시지/상대 메시지 구분 표시

**완료 조건**:
- 메시지 주고받기 성공
- UI 버그 없음

---

### Step 4: Chat 실시간 업데이트 (Supabase Realtime)
**작업**:
- Supabase Realtime 구독 설정
- 새 메시지 자동 업데이트
- 스크롤 자동 이동

**테스트**:
- [ ] 시크릿 창 2개로 테스트
- [ ] A가 보낸 메시지가 B에게 즉시 표시
- [ ] 스크롤 자동으로 맨 아래로 이동
- [ ] 구독 해제 확인 (메모리 누수 방지)

**완료 조건**:
- 실시간 메시지 전송/수신 성공
- 페이지 이탈 시 구독 해제

---

### Step 5: 매칭 성공 모달 개선
**작업**:
- alert() 제거
- 풀스크린 모달 컴포넌트 생성
- Framer Motion 애니메이션
- "Send a Message" / "Keep Swiping" 버튼

**테스트**:
- [ ] 매칭 성공 시 모달 표시
- [ ] 애니메이션 자연스럽게 작동
- [ ] "Send a Message" 클릭 → 채팅 페이지 이동
- [ ] "Keep Swiping" 클릭 → 다음 프로필 표시

**완료 조건**:
- 모달 UI 완성
- 버튼 기능 정상 작동

---

### Step 6: 하단 네비게이션 바
**작업**:
- 고정 하단 네비게이션 컴포넌트
- 4개 탭: Home, Discover, Matches, Profile
- 현재 페이지 하이라이트
- 읽지 않은 메시지 배지 (기본)

**테스트**:
- [ ] 모든 페이지에서 네비게이션 표시
- [ ] 클릭 시 올바른 페이지로 이동
- [ ] 현재 페이지 하이라이트 정확
- [ ] 모바일/데스크톱 반응형 작동

**완료 조건**:
- 네비게이션 모든 페이지 통합
- 반응형 레이아웃 완성

---

## 📋 Phase 2: UX 개선 (다음 주)

### Step 7: 읽지 않은 메시지 배지
**작업**:
- 읽지 않은 메시지 카운트 계산
- Matches 탭에 배지 표시
- 메시지 읽음 처리 (read_at 업데이트)

**테스트**:
- [ ] 새 메시지 도착 시 배지 표시
- [ ] 채팅 페이지 진입 시 읽음 처리
- [ ] 배지 카운트 정확

**완료 조건**: 실시간 배지 업데이트

---

### Step 8: 프로필 사진 업로드
**작업**:
- Supabase Storage 설정
- 이미지 업로드 컴포넌트
- 프로필 사진 표시
- 이미지 압축/리사이징

**테스트**:
- [ ] 이미지 업로드 성공
- [ ] 프로필 페이지에 표시
- [ ] Discover/Matches에서 표시
- [ ] 파일 크기 제한 (최대 5MB)

**완료 조건**: 모든 페이지에서 프로필 사진 표시

---

### Step 9: 프로필 수정 기능
**작업**:
- `/settings` 페이지 생성
- 프로필 정보 수정 폼
- 바이오, 선호도 업데이트

**테스트**:
- [ ] 기존 정보 불러오기
- [ ] 정보 수정 후 저장
- [ ] 다른 페이지에서 업데이트된 정보 확인

**완료 조건**: 프로필 수정 기능 완성

---

## 📋 Phase 3: 고급 기능 (나중에)

### Step 10: Workout 약속 기능
**작업**:
- `workouts` 테이블 사용
- 채팅에서 "Let's workout!" 버튼
- 날짜/시간/장소 선택 모달
- 약속 리스트 페이지

**테스트**: 약속 생성/수락/거절 플로우

---

### Step 11: 알림 시스템
**작업**:
- 새 매칭 알림
- 메시지 도착 알림
- Workout 리마인더

**테스트**: 모든 알림 정상 작동

---

### Step 12: 프리미엄 기능
**작업**:
- 무료/프리미엄 차등화
- Stripe 결제 연동
- "Who liked you" 기능

**테스트**: 결제 플로우 완성

---

## 🧪 테스트 체크리스트 (매 단계)

### 기능 테스트
- [ ] 새 기능 정상 작동
- [ ] 기존 기능 영향 없음
- [ ] 에러 메시지 없음
- [ ] 로딩 상태 표시

### UI/UX 테스트
- [ ] 모바일 반응형
- [ ] 다크모드 (선택사항)
- [ ] 로딩 인디케이터
- [ ] 빈 상태 UI

### 데이터 테스트
- [ ] 데이터 올바르게 저장
- [ ] 데이터 올바르게 불러오기
- [ ] RLS 정책 작동
- [ ] 에러 핸들링

### 성능 테스트
- [ ] 페이지 로드 < 2초
- [ ] API 응답 < 500ms
- [ ] 메모리 누수 없음
- [ ] 구독 해제 확인

---

## 🐛 에러 발생 시 프로토콜

### 1. 에러 로그 확인
```bash
# 브라우저 콘솔
F12 → Console 탭

# Supabase 에러
Network 탭 → 실패한 요청 확인
```

### 2. 문제 재현
- 에러가 발생한 정확한 단계 기록
- 스크린샷/비디오 캡처
- 사용자 입력 데이터 기록

### 3. 원인 분석
- 프론트엔드 에러: 컴포넌트 로직
- 백엔드 에러: Supabase 쿼리/RLS
- 데이터 에러: 스키마 불일치

### 4. 수정 및 재테스트
- 에러 수정
- 동일한 플로우 재테스트
- 다른 엣지 케이스 테스트

### 5. 문제 해결 문서화
- CLAUDE.md에 기록
- 해결 방법 명시
- 재발 방지 체크리스트

---

## 📝 커밋 메시지 규칙

### 형식
```
feat: [기능 요약]

**작업 내용**:
- [상세 설명 1]
- [상세 설명 2]

**테스트**:
- [테스트 항목 1]
- [테스트 항목 2]

**다음 단계**: [다음에 할 일]

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

### 예시
```
feat: Matches 리스트 페이지 구현

**작업 내용**:
- /matches 페이지 생성
- 매칭된 사람들 리스트 표시
- 최근 메시지 미리보기 추가
- 빈 상태 UI 구현

**테스트**:
- ✅ 매칭 없을 때 빈 상태 표시
- ✅ 매칭 있을 때 리스트 표시
- ✅ 클릭 시 채팅 페이지 이동

**다음 단계**: Chat 1:1 채팅 기본 기능 구현

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

---

## 🎯 진행 상황 트래킹

### 완료된 단계
- [x] 회원가입/로그인 UX 개선
- [x] 매칭 후 기능 설계 문서 작성

### 현재 진행 중
- [ ] Step 1: 데이터베이스 스키마 구축

### 대기 중
- [ ] Step 2: Matches 리스트 페이지
- [ ] Step 3: Chat 1:1 채팅 (기본)
- [ ] Step 4: Chat 실시간 업데이트
- [ ] Step 5: 매칭 성공 모달 개선
- [ ] Step 6: 하단 네비게이션 바

---

## 📊 성공 지표

### Phase 1 완료 기준
- [ ] 모든 Step 1-6 완료
- [ ] 테스트 체크리스트 100% 통과
- [ ] 에러 0개
- [ ] 사용자 플로우 완전 작동:
  - 회원가입 → 프로필 작성 → 스와이프 → 매칭 → 채팅 → 반복

### Phase 2 완료 기준
- [ ] 읽지 않은 메시지 배지
- [ ] 프로필 사진 업로드
- [ ] 프로필 수정 기능

### Phase 3 완료 기준
- [ ] Workout 약속
- [ ] 알림 시스템
- [ ] 프리미엄 기능

---

**작성일**: 2025-01-10
**작성자**: Claude + 박재현
**프로토콜 버전**: 1.0

**이 프로토콜을 항상 따르세요!**
